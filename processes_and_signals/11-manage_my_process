#!/usr/bin/env bash
#Bash Script that manages manage_my_process.

#When passing the argument "start":
#Starts manage_my_process
#Creates a file containing its PID in /var/run/my_process.pid
#Displays manage_my_process started

#When passing the argument "stop":
#Stops manage_my_process
#Deletes the file /var/run/my_process.pid
#Displays manage_my_process stopped

#When passing the argument "restart":
#Stops manage_my_process
#Deletes the file /var/run/my_process.pid
#Starts manage_my_process
#Creates a file containing its PID in /var/run/my_process.pid
#Displays manage_my_process restarted

#Displays Usage: manage_my_process {start|stop|restart}

PID_FILE="/var/run/my_process.pid"
MANAGE_PROCESS="./manage_my_process"

echo "Script started with argument: $1"

if [ "$1" = "start" ]; then
    if [ -f "$PID_FILE" ]; then
        echo "Process is already running with PID: $(cat "$PID_FILE")"
        exit 1
    fi
    echo "Starting manage_my_process..."
    $MANAGE_PROCESS &
    if [ $? -ne 0 ]; then
        echo "Failed to start manage_my_process"
        exit 1
    fi
    mkdir -p /var/run
    echo "$!" > "$PID_FILE"
    if [ $? -ne 0 ]; then
        echo "Failed to write PID file"
        exit 1
    fi
    echo "manage_my_process started with PID: $(cat "$PID_FILE")"

elif [ "$1" = "stop" ]; then
    if [ ! -f "$PID_FILE" ]; then
        echo "No PID file found. Is the process running?"
        exit 1
    fi
    echo "Stopping manage_my_process..."
    kill "$(cat "$PID_FILE")"
    if [ $? -ne 0 ]; then
        echo "Failed to kill process"
        exit 1
    fi
    rm "$PID_FILE"
    if [ $? -ne 0 ]; then
        echo "Failed to remove PID file"
        exit 1
    fi
    echo "manage_my_process stopped"

elif [ "$1" = "restart" ]; then
    if [ -f "$PID_FILE" ]; then
        echo "Restarting manage_my_process..."
        kill "$(cat "$PID_FILE")"
        if [ $? -ne 0 ]; then
            echo "Failed to kill process"
            exit 1
        fi
        rm "$PID_FILE"
        if [ $? -ne 0 ]; then
            echo "Failed to remove PID file"
            exit 1
        fi
    else
        echo "No PID file found. Starting manage_my_process..."
    fi
    $MANAGE_PROCESS &
    if [ $? -ne 0 ]; then
        echo "Failed to start manage_my_process"
        exit 1
    fi
    mkdir -p /var/run
    echo "$!" > "$PID_FILE"
    if [ $? -ne 0 ]; then
        echo "Failed to write PID file"
        exit 1
    fi
    echo "manage_my_process restarted with PID: $(cat "$PID_FILE")"

else
    echo "Usage: manage_my_process {start|stop|restart}"
    exit 1
fi
